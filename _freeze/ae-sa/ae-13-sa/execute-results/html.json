{
  "hash": "0704a91ef2178b775ed66341b18853d6",
  "result": {
    "markdown": "---\ntitle: \"Intro to Inference: Bootstrap + Hypothesis Testing Continued\"\nsubtitle: \"Suggested Answers\"\ncategories: \n  - Application exercise\neditor: visual\n---\n\n\n# Packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──\n✔ ggplot2 3.4.0     ✔ purrr   0.3.5\n✔ tibble  3.1.8     ✔ dplyr   1.0.9\n✔ tidyr   1.2.1     ✔ stringr 1.4.1\n✔ readr   2.1.3     ✔ forcats 0.5.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'ggplot2' was built under R version 4.2.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'tidyr' was built under R version 4.2.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'readr' was built under R version 4.2.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'purrr' was built under R version 4.2.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\n```\n:::\n\n```{.r .cell-code}\nlibrary(tidymodels)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching packages ────────────────────────────────────── tidymodels 1.0.0 ──\n✔ broom        1.0.1     ✔ rsample      1.1.0\n✔ dials        1.1.0     ✔ tune         1.0.1\n✔ infer        1.0.3     ✔ workflows    1.1.0\n✔ modeldata    1.0.1     ✔ workflowsets 1.0.0\n✔ parsnip      1.0.3     ✔ yardstick    1.1.0\n✔ recipes      1.0.3     \n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'broom' was built under R version 4.2.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'dials' was built under R version 4.2.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'parsnip' was built under R version 4.2.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'recipes' was built under R version 4.2.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──\n✖ scales::discard() masks purrr::discard()\n✖ dplyr::filter()   masks stats::filter()\n✖ recipes::fixed()  masks stringr::fixed()\n✖ dplyr::lag()      masks stats::lag()\n✖ yardstick::spec() masks readr::spec()\n✖ recipes::step()   masks stats::step()\n• Use tidymodels_prefer() to resolve common conflicts.\n```\n:::\n\n```{.r .cell-code}\nlibrary(openintro)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: airports\nLoading required package: cherryblossom\nLoading required package: usdata\n\nAttaching package: 'openintro'\n\nThe following object is masked from 'package:modeldata':\n\n    ames\n```\n:::\n:::\n\n\n## Two Categorical Variables: Case study: CPR and blood thinner\n\nCardiopulmonary resuscitation (CPR) is a procedure used on individuals suffering a heart attack when other emergency resources are unavailable. This procedure is helpful in providing some blood circulation to keep a person alive, but CPR chest compressions can also cause internal injuries. Internal bleeding and other injuries that can result from CPR complicate additional treatment efforts. For instance, blood thinners may be used to help release a clot that is causing the heart attack once a patient arrives in the hospital. However, blood thinners negatively affect internal injuries.\n\nHere we consider an experiment with patients who underwent CPR for a heart attack and were subsequently admitted to a hospital. Each patient was randomly assigned to either receive a blood thinner (treatment group) or not receive a blood thinner (control group). The outcome variable of interest was whether the patient survived for at least 24 hours. We are interested in if the proportion of patients who died were different between those who were given blood thinners or not. Note: We will considered \"died\" as a \"success\"\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(cpr)\n```\n:::\n\n\nNow, write out your null and alternative hypothesis in proper notation (control - treatment).\n\n$H_0$: $\\pi_c - \\pi_t$ = 0\n\n$H_a$: $\\pi_c - \\pi_t$ $\\neq$ 0\n\nCalculate your sample statistic below. Use proper notation (control - treatment). We will considered \"died\" as a \"success\" - what we are taking the proportion of, for the remainder of this activity.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncpr |> \n  group_by(group, outcome) |>\n  summarize(count = n())\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'group'. You can override using the\n`.groups` argument.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 3\n# Groups:   group [2]\n  group     outcome  count\n  <fct>     <fct>    <int>\n1 control   died        39\n2 control   survived    11\n3 treatment died        26\n4 treatment survived    14\n```\n:::\n\n```{.r .cell-code}\nestimate <- .78 - .65\n```\n:::\n\n\n## Simulate\n\nNext, explain how one dot (observation) is created on the permutation null distribution used to test our hypotheses...\n\n**Add Response**\n\nNow, repeat that process above 1000 times and calculate the p-value below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1234)\n\nnull_dist <- cpr |>\n  specify(response = outcome , explanatory = group , success = \"died\") |>\n  hypothesize(null = \"independence\") |>\n  generate(reps = 1000, type = \"permute\") |>\n  calculate(stat = \"diff in props\" , order = c(\"control\", \"treatment\"))\n```\n:::\n\n\nAnd like last time.. let's calculate the p-value!\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvisualize(null_dist) +\n shade_p_value(obs_stat = .13, direction = \"two-sided\") \n```\n\n::: {.cell-output-display}\n![](ae-13-sa_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\nnull_dist |>\n  get_p_value(obs_stat = .13, direction = \"two-sided\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 1\n  p_value\n    <dbl>\n1   0.216\n```\n:::\n:::\n\n\np-value = 0.216\n\n\\>\n\nBased on a significance level of 0.05...\n\nDecision: Fail to reject the null hypothesis\n\nFail to reject that the true proportion of patients who died on blood thinners is the same than the true proportion of patients who died without blood thinners\n\nConclusion: Weak evidence to conclude the alternative hypothesis that the true proportion of patients who died on blood thinners is different than the true proportion of patients who died without blood thinners\n\n# One quantitative variable\n\nWe have data on the price per guest (ppg) for a random sample of 50 Airbnb listings in 2020 for Asheville, NC. We are going to use these data to investigate what we would of expected to pay for an Airbnb in in Asheville, NC in June 2020. Read in the data and answer the following questions. Today, we are going to investigate if the mean price of an Airbnb in Ashville, NC in June 2020 was larger than 60.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n\nabb <- read_csv(\"data/asheville.csv\")\n\nglimpse(abb)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 50\nColumns: 1\n$ ppg <dbl> 48.00000, 40.00000, 99.00000, 13.00000, 55.00000, 75.00000, 74.000…\n```\n:::\n:::\n\n\n## Setting up the hypotheses\n\nBased on the context of the problem, write out the correct null and alternative hypothesis. Do this in both words *and* in proper notation.\n\n$H_0:$ $\\mu$ = 60\n\nThe true mean price per guest of an Airbnb in Ashville, NC in June 2020 is equal to 60.\n\n$H_a:$ $\\mu$ \\> 60\n\nThe true (population) mean price per guest of an Airbnb in Ashville, NC in June 2020 is larger to 60.\n\n## Motivation\n\nWe want to know how unlikely it would be to observe our statistic under the assumption of the null hypothesis. Calculate and report the sample statistic below using proper notation.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nabb |>\n  summarize(mean_ppg = mean(ppg))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 1\n  mean_ppg\n     <dbl>\n1     76.6\n```\n:::\n:::\n\n\n## Building a distribution\n\nLet's use simulation-based methods to conduct the hypothesis test specified above. We'll start by generating the null distribution.\n\n-   How do we generate the null distribution? Detail the steps below.\n\n-   We shift! We shift each observation by -16.6 so that the new sapmle mean of our data is 60 (null value)\n\n-   Next, we resample with replacement 50 times and take the mean.\n\n-   We do that process 1000 times and plot the distribution.\n\nLet's repeat this process many many times below using the following code\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(101321)\n\nnull_dist <- abb |>\n  specify(response = ppg) |>\n  hypothesize(null = \"point\", mu = 60) |>\n  generate(reps = 1000, type = \"bootstrap\") |>\n  calculate(stat = \"mean\")\n```\n:::\n\n\nNote: What has changed in this set of code from the previous exercises?\n\nmu = type = bootstrap stat = mean\n\nTake a `glimpse` at null_dist. What does this represent?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(null_dist)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 1,000\nColumns: 2\n$ replicate <int> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 1…\n$ stat      <dbl> 54.94833, 60.20833, 48.79833, 55.28833, 64.59000, 42.30500, …\n```\n:::\n:::\n\n\nnull_dist has all 1000 of our resampled means!\n\n## Visualize\n\nNow, create an appropriate visualization fo your null distribution using `ggplot`. Where is this distribution centered? Why does this make sense?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnull_dist |> \n  ggplot(\n    aes(x = stat)\n  ) + \n  geom_histogram() + \n  geom_vline(xintercept = 76.6)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n```\n:::\n\n::: {.cell-output-display}\n![](ae-13-sa_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\nNow, add a vertical line on your null distribution that represents your sample statistic. Based on the position of this line, is you your sample mean is an unusual observation under the assumption of the null hypothesis?\n\nWe quantify this using a p-value (as before).\n\n-   Calculate your p-value below\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnull_dist |>\n  get_p_value(obs_stat = 76.6 , direction = \"greater\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 1\n  p_value\n    <dbl>\n1   0.012\n```\n:::\n:::\n\n\nLet's visualize it!\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvisualize(null_dist) +\n shade_p_value(obs_stat = 76.6 , direction = \"greater\")\n```\n\n::: {.cell-output-display}\n![](ae-13-sa_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n-   Interpret your p-value in the context of the problem\n\nThe probability of observing ppg of 76.6 or something larger, given that the true mean ppg really is equal to 60, is about 0.012.\n\n## Two-sided\n\nSuppose instead you wanted to test the claim that the mean price of an Airbnb is not equal to \\$60. Which of the following would change? *Select all that apply.*\n\na.  Null hypothesis **b. Alternative hypothesis**\nb.  Null distribution **d. p-value**\n\n# Difference in means\n\nThe Iris Dataset contains four features (length and width of sepals and petals) of 50 samples of three species of Iris (Iris setosa, Iris virginica and Iris versicolor). A sepal is the outer parts of the flower (often green and leaf-like) that enclose a developing bud. The petal are parts of a flower that are the pollen producing part of the flower that are often conspicuously colored.\n\nThe data were collected in 1936 at the Gaspé Peninsula, in Canada. For the first question of the exam, you will use this data sets to investigate a variety of relationships to learn more about each of these three flower species. The data set is prepackaged in R, and is called `iris`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(iris)\n```\n:::\n\n\nGoal: Previously, we had conducted a hypothesis test for a single mean (price per guest). Now, we are extending what we know to the difference in mean case.\n\nSpecifically, we are going to test for a difference in mean Sepal length between the Setosa and Versicolor.\n\n## EDA\n\nFirst, we want to filter the data set to only contain our two `Species`. Please create a new data set that achieves this below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\niris_filter <- iris |>\n  filter(Species != \"virginica\")\n```\n:::\n\n\nBelow, calculate and create the following:\n\n-- Mean sepal length for each group\n\n-- Box plot of Sepal length for each group\n\n\n::: {.cell}\n\n```{.r .cell-code}\niris_filter |>\n  group_by(Species) |>\n  summarise(mean_sl = mean(Sepal.Length))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 2\n  Species    mean_sl\n  <fct>        <dbl>\n1 setosa        5.01\n2 versicolor    5.94\n```\n:::\n\n```{.r .cell-code}\niris_filter |>\n  ggplot(\n    aes(x = Species, y = Sepal.Length)\n  ) + \n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](ae-13-sa_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\nWhat is your point estimate? Using proper notation, report it below (setosa - versicolor).\n\n$\\bar{x_s} - \\bar{x_v}$ = -0.93\n\nNow, we are going to see if this difference is by chance, or if this difference is meaningful...\n\nBelow, write out the null and alternative hypothesis in both words + notation.\n\n$H_0: \\mu_s - \\mu_v = 0$\n\n$H_a: \\mu_s - \\mu_v \\neq 0$\n\n## Building a distribution\n\nLet's use simulation-based methods to conduct the hypothesis test specified above. We'll start by generating the null distribution.\n\n-   How do we generate one dot (one observation) on the null distribution? Detail the steps below.\n\n-   We shuffle / randomize / permute responses to new values of our grouping variable.\n\n-   Next, we take the new randomized mean for each group and subtract the two\n\n-   We do this process 1000 times and make our distribution!\n\nNow, let's do the above process many many times...\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnull_dist <- iris_filter |>\n  specify(response = Sepal.Length, explanatory = Species) |>\n  hypothesize(null = \"independence\") |>\n  generate(reps = 1000, type = \"permute\") |>\n  calculate(stat = \"diff in means\", order = c(\"setosa\", \"versicolor\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nDropping unused factor levels virginica from the supplied explanatory variable 'Species'.\n```\n:::\n:::\n\n\n## Visualize\n\nNow, create an appropriate visualization fo your null distribution. Where is this distribution centered? Why does this make sense?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnull_dist |> \n  ggplot(\n    aes(x = stat)\n  ) + \n  geom_histogram()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n```\n:::\n\n::: {.cell-output-display}\n![](ae-13-sa_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\nNow, add a vertical line on your null distribution that represents your sample statistic. Based on the position of this line, do you your sample mean is an unusual observation under the assumption of the null hypothesis?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnull_dist |> \n  ggplot(\n    aes(x = stat)\n  ) + \n  geom_histogram() + \n  geom_vline(xintercept = -0.93)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n```\n:::\n\n::: {.cell-output-display}\n![](ae-13-sa_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\nCalculate your p-value below\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnull_dist |>\n  get_p_value(obs_stat = -.93, direction = \"both\")\n```\n:::\n\n\np-value \\~ \\< 0.001\n\nAnd visualize it..\n\nLet's visualize it!\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvisualize(null_dist) +\n shade_p_value(obs_stat = -0.93, direction = \"both\") + \n shade_p_value(obs_stat = 0.93, direction = \"two sided\")\n```\n\n::: {.cell-output-display}\n![](ae-13-sa_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\nUsing your associated p-value, please write the following in the context of the problem. Assume that $\\alpha$ = 0.05.\n\n-- Interpretation of p-value: The probability of observing a difference in mean sepal length between setosa and versicolor (setosa - versicolor) equal to -0.93 or something more extreme given the true mean sepal length between setosa and versicolor are equal is roughly \\< 0.001.\n\n-- Decision: We have evidence to reject the null hypothesis that the true mean sepal length for the setosa species is equal to the true mean sepal length for the versicolor species.\n\n-- Conclusion: Strong evidence to conclude that the true mean sepal length for the setosa species is different than the true mean sepal length for the versicolor species.\n",
    "supporting": [
      "ae-13-sa_files\\figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}