{
  "hash": "147db59df4e423748e010320e255524a",
  "result": {
    "markdown": "---\ntitle: \"AE 07: Pivoting StatSci Majors - SUGGESTED ANSWERS\"\ncategories: \n  - Application exercise\neditor: visual\n---\n\n\n::: callout-important\nGo to the [course GitHub organization](https://github.com/sta199-s23-2) and locate the repo titled `exam1-review-s23-YOUR_GITHUB_USERNAME` to get started.\n\nThis AE is due Monday, Feb 13 at 11:59pm.\n:::\n\n## Packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n:::\n\n\n## Goal\n\nOur ultimate goal in this application exercise is to make the following data visualization.\n\n![](images/statsci-plot.png){fig-alt=\"Line plot of numbers of Statistical Science majors over the years (2011 - 2021). Degree types represented are BS, BS2, AB, AB2. There is an increasing trend in BS degrees and somewhat steady trend in AB degrees.\" fig-align=\"center\"}\n\n-   **Your turn (3 minutes):** Take a close look at the plot and describe what it shows in 2-3 sentences.\n\n*Add your response here.*\n\n## Data\n\nThe data come from the [Office of the University Registrar](https://registrar.duke.edu/registration/enrollment-statistics). They make the data available as a table that you can download as a PDF, but I've put the data exported in a CSV file for you. Let's load that in.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstatsci <- read_csv(\"data/statsci.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 4 Columns: 13\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (1): degree\ndbl (12): id, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n:::\n\n\nAnd let's take a look at the data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(statsci)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 4\nColumns: 13\n$ id     <dbl> 1, 2, 3, 4\n$ degree <chr> \"Statistical Science (AB2)\", \"Statistical Science (AB)\", \"Stati…\n$ `2011` <dbl> NA, 2, 2, 5\n$ `2012` <dbl> 1, 2, 6, 9\n$ `2013` <dbl> NA, 4, 1, 4\n$ `2014` <dbl> NA, 1, NA, 13\n$ `2015` <dbl> 4, 3, 5, 10\n$ `2016` <dbl> 4, 6, 6, 17\n$ `2017` <dbl> 1, 3, 6, 24\n$ `2018` <dbl> NA, 4, 8, 21\n$ `2019` <dbl> NA, 4, 8, 26\n$ `2020` <dbl> 1, 1, 17, 27\n$ `2021` <dbl> 2, NA, 16, 35\n```\n:::\n:::\n\n\nThe dataset has 4 rows and 13 columns. The first column (variable) is the `degree`, and there are 4 possible degrees: BS (Bachelor of Science), BS2 (Bachelor of Science, 2nd major), AB (Bachelor of Arts), AB2 (Bachelor of Arts, 2nd major). The remaining columns show the number of students graduating with that major in a given academic year from 2011 to 2021.\n\n-   **Your turn (4 minutes):** Take a look at the plot we aim to make and sketch / think about the data frame we need to make the plot. Determine what each row and each column of the data frame should be. *Hint:* We need data to be in columns to map to `aes`thetic elements of the plot.\n\n*Add your response here.*\n\n## Pivoting\n\n-   **Demo:** Pivot the `statsci` data frame *longer* such that each row represents a degree type / year combination and `year` and `n`umber of graduates for that year are columns in the data frame.\n\nExplain why the following code below accomplishes the question above.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstatsci |>\n  pivot_longer(\n    cols = !c(degree,id),\n    names_to = \"year\",\n    values_to = \"n\"\n  ) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 44 × 4\n      id degree                    year      n\n   <dbl> <chr>                     <chr> <dbl>\n 1     1 Statistical Science (AB2) 2011     NA\n 2     1 Statistical Science (AB2) 2012      1\n 3     1 Statistical Science (AB2) 2013     NA\n 4     1 Statistical Science (AB2) 2014     NA\n 5     1 Statistical Science (AB2) 2015      4\n 6     1 Statistical Science (AB2) 2016      4\n 7     1 Statistical Science (AB2) 2017      1\n 8     1 Statistical Science (AB2) 2018     NA\n 9     1 Statistical Science (AB2) 2019     NA\n10     1 Statistical Science (AB2) 2020      1\n# … with 34 more rows\n```\n:::\n:::\n\n\n-   **Question:** What is the type of the `year` variable? Why? What should it be?\n\nIt's a (categorical/quantitative) variable since the information came from the columns of the original data frame and R cannot know that these character strings represent years. The variable type should be (categorical/quantitative).\n\n-   Demo: Start over with pivoting, and this time also make sure `year` is a numerical variable in the resulting data frame. How does this code differ from above?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstatsci |>\n  pivot_longer(\n    cols = -c(degree,id),\n    names_to = \"year\",\n    names_transform = as.numeric,\n    values_to = \"n\"\n  )  \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 44 × 4\n      id degree                     year     n\n   <dbl> <chr>                     <dbl> <dbl>\n 1     1 Statistical Science (AB2)  2011    NA\n 2     1 Statistical Science (AB2)  2012     1\n 3     1 Statistical Science (AB2)  2013    NA\n 4     1 Statistical Science (AB2)  2014    NA\n 5     1 Statistical Science (AB2)  2015     4\n 6     1 Statistical Science (AB2)  2016     4\n 7     1 Statistical Science (AB2)  2017     1\n 8     1 Statistical Science (AB2)  2018    NA\n 9     1 Statistical Science (AB2)  2019    NA\n10     1 Statistical Science (AB2)  2020     1\n# … with 34 more rows\n```\n:::\n:::\n\n\n-   **Question:** What does an `NA` mean in this context? *Hint:* The data come from the university registrar, and they have records on every single graduates, there shouldn't be anything \"unknown\" to them about who graduated when.\n\n`NA`s should actually be 0s.\n\n## Start Here ------------------------------------------------------------------\n\n-   **Demo:** Add on to your pipeline that you started with pivoting and convert `NA`s in `n` to `0`s.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstatsci |>\n  pivot_longer(\n    cols = !c(id,degree),\n    names_to = \"year\",\n    names_transform = as.numeric,\n    values_to = \"n\"\n  ) |>\n  mutate(n = if_else(is.na(n), 0, n))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 44 × 4\n      id degree                     year     n\n   <dbl> <chr>                     <dbl> <dbl>\n 1     1 Statistical Science (AB2)  2011     0\n 2     1 Statistical Science (AB2)  2012     1\n 3     1 Statistical Science (AB2)  2013     0\n 4     1 Statistical Science (AB2)  2014     0\n 5     1 Statistical Science (AB2)  2015     4\n 6     1 Statistical Science (AB2)  2016     4\n 7     1 Statistical Science (AB2)  2017     1\n 8     1 Statistical Science (AB2)  2018     0\n 9     1 Statistical Science (AB2)  2019     0\n10     1 Statistical Science (AB2)  2020     1\n# … with 34 more rows\n```\n:::\n:::\n\n\n-   **Demo:** In our plot the degree types are BS, BS2, AB, and AB2. This information is in our dataset, in the `degree` column, but this column also has additional characters we don't need. Create a new column called `degree_type` with levels BS, BS2, AB, and AB2 (in this order) based on `degree`. The code below accomplishes this for you. Comment / practice reading each line.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnew.data <- statsci |>\n  pivot_longer(\n    cols = !c(id,degree), #columns we do not want to make values\n    names_to = \"year\", #column name\n    names_transform = as.numeric, #change year to numeric\n    values_to = \"n\" #column name\n  ) |>\n  mutate(n = if_else(is.na(n), 0, n)) |> #remove NAs and replace with 0s\n  separate(degree, sep = \"\\\\(\", into = c(\"major\", \"degree_type\")) |> #separate column degree to two new columns. Separate on the input ()\n  mutate(\n    degree_type = str_remove(degree_type, \"\\\\)\"), #remove string )\n    degree_type = fct_relevel(degree_type, \"BS\", \"BS2\", \"AB\", \"AB2\") #relevel factors to match plot\n    )\n```\n:::\n\n\n-   **Your turn (5 minutes):** Now we start making our plot, but let's not get too fancy right away. Create the following plot, which will serve as the \"first draft\" on the way to our [Goal]. Do this by adding on to your pipeline from earlier.\n\n![](images/statsci-plot-draft.png){fig-alt=\"Line plot of numbers of Statistical Science majors over the years (2011 - 2021). Degree types represented are BS, BS2, AB, AB2. There is an increasing trend in BS degrees and somewhat steady trend in AB degrees.\" fig-align=\"center\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstatsci |>\n  pivot_longer(\n    cols = !c(id,degree),\n    names_to = \"year\",\n    names_transform = as.numeric,\n    values_to = \"n\"\n  ) |>\n  mutate(n = if_else(is.na(n), 0, n)) |>\n  separate(degree, sep = \" \\\\(\", into = c(\"major\", \"degree_type\")) |>\n  mutate(\n    degree_type = str_remove(degree_type, \"\\\\)\"),\n    degree_type = fct_relevel(degree_type, \"BS\", \"BS2\", \"AB\", \"AB2\")\n    ) |> \n  ggplot(\n    aes(x = year, y = n, color = degree_type)\n  ) + \n  geom_point() +\n  geom_line()\n```\n\n::: {.cell-output-display}\n![](ae-07-A_files/figure-html/initial-plot-1.png){width=672}\n:::\n:::\n\n\n-   **Your turn (4 minutes):** What aspects of the plot need to be updated to go from the draft you created above to the [Goal] plot at the beginning of this application exercise.\n\n-   x-axis\n\n-   line colors\n\n-   labels\n\n-   theme\n\n-   legend\n\n-   Demo: Update x-axis scale such that the years displayed go from 2011 to 2021 in increments of 2 years. Do this by adding on to your pipeline from earlier.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstatsci |>\n  pivot_longer(\n    cols = !c(id,degree),\n    names_to = \"year\",\n    names_transform = as.numeric,\n    values_to = \"n\"\n  ) |>\n  mutate(n = if_else(is.na(n), 0, n)) |>\n  separate(degree, sep = \" \\\\(\", into = c(\"major\", \"degree_type\")) |>\n  mutate(\n    degree_type = str_remove(degree_type, \"\\\\)\"),\n    degree_type = fct_relevel(degree_type, \"BS\", \"BS2\", \"AB\", \"AB2\")\n    ) |>\n  ggplot(aes(x = year, y = n, color = degree_type)) +\n  geom_point() +\n  geom_line() +\n  scale_x_continuous(breaks = seq(2011,2021,2))\n```\n\n::: {.cell-output-display}\n![](ae-07-A_files/figure-html/x-axis-1.png){width=672}\n:::\n:::\n\n\n-   **Demo:** Update line colors using the following level / color assignments. Once again, do this by adding on to your pipeline from earlier.\n    -   \"BS\" = \"cadetblue4\"\n\n    -   \"BS2\" = \"cadetblue3\"\n\n    -   \"AB\" = \"lightgoldenrod4\"\n\n    -   \"AB2\" = \"lightgoldenrod3\"\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstatsci |>\n  pivot_longer(\n    cols = !c(id,degree),\n    names_to = \"year\",\n    names_transform = as.numeric,\n    values_to = \"n\"\n  ) |>\n  mutate(n = if_else(is.na(n), 0, n)) |>\n  separate(degree, sep = \" \\\\(\", into = c(\"major\", \"degree_type\")) |>\n  mutate(\n    degree_type = str_remove(degree_type, \"\\\\)\"),\n    degree_type = fct_relevel(degree_type, \"BS\", \"BS2\", \"AB\", \"AB2\")\n    ) |>\n  ggplot(aes(x = year, y = n, color = degree_type)) +\n  geom_point() +\n  geom_line() +\n  scale_x_continuous(breaks = seq(2011, 2021, 2)) +\n  scale_color_manual(\n    values = c(\"BS\" = \"cadetblue4\", \n               \"BS2\" = \"cadetblue3\",\n               \"AB\" = \"lightgoldenrod4\",\n               \"AB2\" = \"lightgoldenrod3\")\n  )\n```\n\n::: {.cell-output-display}\n![](ae-07-A_files/figure-html/color-1.png){width=672}\n:::\n:::\n\n\n-   **Your turn (4 minutes):**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstatsci |>\n  pivot_longer(\n    cols = !c(id,degree),\n    names_to = \"year\",\n    names_transform = as.numeric,\n    values_to = \"n\"\n  ) |>\n  mutate(n = if_else(is.na(n), 0, n)) |>\n  separate(degree, sep = \" \\\\(\", into = c(\"major\", \"degree_type\")) |>\n  mutate(\n    degree_type = str_remove(degree_type, \"\\\\)\"),\n    degree_type = fct_relevel(degree_type, \"BS\", \"BS2\", \"AB\", \"AB2\")\n    ) |>\n  ggplot(aes(x = year, y = n, color = degree_type)) +\n  geom_point() +\n  geom_line() +\n  scale_x_continuous(breaks = seq(2011, 2021, 2)) +\n  scale_color_manual(\n    values = c(\"BS\" = \"cadetblue4\",\n               \"BS2\" = \"cadetblue3\",\n               \"AB\" = \"lightgoldenrod4\",\n               \"AB2\" = \"lightgoldenrod3\")) +\n  labs(\n    x = \"Graduation year\",\n    y = \"Number of majors graduating\",\n    color = \"Degree type\",\n    title = \"Statistical Science majors over the years\",\n    subtitle = \"Academic years 2011 - 2021\",\n    caption = \"Source: Office of the University Registrar\\nhttps://registrar.duke.edu/registration/enrollment-statistics\"\n  ) +\n  theme_minimal() \n```\n\n::: {.cell-output-display}\n![](ae-07-A_files/figure-html/plot-labels-1.png){width=672}\n:::\n:::\n\n\n-   **Demo:** Finally, adding to your pipeline you've developed so far, move the legend into the plot, make its background white, and its border gray. Set `fig-width: 7` and `fig-height: 5` for your plot in the chunk options. The code below does this for you. Practice reading the code as a sentence below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstatsci |>\n  pivot_longer(\n    cols = !c(id,degree),\n    names_to = \"year\",\n    names_transform = as.numeric,\n    values_to = \"n\"\n  ) |>\n  mutate(n = if_else(is.na(n), 0, n)) |>\n  separate(degree, sep = \" \\\\(\", into = c(\"major\", \"degree_type\")) |>\n  mutate(\n    degree_type = str_remove(degree_type, \"\\\\)\"),\n    degree_type = fct_relevel(degree_type, \"BS\", \"BS2\", \"AB\", \"AB2\")\n    ) |>\n  ggplot(aes(x = year, y = n, color = degree_type)) +\n  geom_point() +\n  geom_line() +\n  scale_x_continuous(breaks = seq(2011, 2021, 2)) +\n  scale_color_manual(\n    values = c(\"BS\" = \"cadetblue4\",\n               \"BS2\" = \"cadetblue3\",\n               \"AB\" = \"lightgoldenrod4\",\n               \"AB2\" = \"lightgoldenrod3\")) +\n  labs( #add labels to plot using labs tab\n    x = \"Graduation year\",\n    y = \"Number of majors graduating\",\n    color = \"Degree type\",\n    title = \"Statistical Science majors over the years\",\n    subtitle = \"Academic years 2011 - 2021\",\n    caption = \"Source: Office of the University Registrar\\nhttps://registrar.duke.edu/registration/enrollment-statistics\"\n  ) +\n  theme_minimal() + #add theme\n  theme( #function to change elements of legend\n    legend.position = c(0.2,0.8), #change position\n    legend.background = element_rect( #change legend rec color\n      fill = \"white\" , color = \"gray\"\n    )\n  )\n```\n\n::: {.cell-output-display}\n![](ae-07-A_files/figure-html/final-plot-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "ae-07-A_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}