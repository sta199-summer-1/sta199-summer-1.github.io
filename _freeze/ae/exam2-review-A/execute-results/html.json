{
  "hash": "8d30cabb5942d2efb592b23ae0b82dbb",
  "result": {
    "markdown": "---\ntitle: \"Inference overview + Review\"\nformat: html\neditor: visual\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tidymodels)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrc <- read_csv(\"data/roller_coasters.csv\")\n```\n:::\n\n\nIn this application exercise, we will be looking at a roller coaster and amusement park database by Duane Marden.[^1] This database records multiple features of roller coasters. For the purpose of this activity, we will work with a random sample of 157 roller coasters.\n\n[^1]: [Roller Coaster DataBase](https://rcdb.com/), [UltimateRollerCoaster.com](https://www.ultimaterollercoaster.com/), [ESTEEM: Enhancing Statistics Teachers Education with E-Modules](https://www.fi.ncsu.edu/teams/hirise/).\n\n+---------------------+--------------------------------------------------------------------------+\n| **Variable**        | **Description**                                                          |\n+:====================+:=========================================================================+\n| `age_group`         | 1: Older (Built between 1900-1979)                                       |\n|                     |                                                                          |\n|                     | 2: Recent (1980-1999)                                                    |\n|                     |                                                                          |\n|                     | 3: Newest (2000-current)                                                 |\n+---------------------+--------------------------------------------------------------------------+\n| `coaster`           | Name of the roller coaster                                               |\n+---------------------+--------------------------------------------------------------------------+\n| `park`              | Name of the park where the roller coaster is located                     |\n+---------------------+--------------------------------------------------------------------------+\n| `city`              | City where the roller coaster is located                                 |\n+---------------------+--------------------------------------------------------------------------+\n| `state`             | State where the roller coaster is located                                |\n+---------------------+--------------------------------------------------------------------------+\n| `type`              | Material of track (Steel or Wooden)                                      |\n+---------------------+--------------------------------------------------------------------------+\n| `year_opened`       | Year when roller coaster opened                                          |\n+---------------------+--------------------------------------------------------------------------+\n| `top_speed`         | Maximum speed of roller coaster (mph)                                    |\n+---------------------+--------------------------------------------------------------------------+\n| `max_height`        | Highest point of roller coaster (ft)                                     |\n+---------------------+--------------------------------------------------------------------------+\n| `drop`              | Length of largest gap between high and low points of roller coaster (ft) |\n+---------------------+--------------------------------------------------------------------------+\n| `length`            | Length of roller coaster track (ft)                                      |\n+---------------------+--------------------------------------------------------------------------+\n| `duration`          | Time length of roller coaster ride (sec)                                 |\n+---------------------+--------------------------------------------------------------------------+\n| `inversions`        | Whether or not roller coaster flips passengers at any point (Yes or No)  |\n+---------------------+--------------------------------------------------------------------------+\n| `num_of_inversions` | Number of times roller coaster flips passengers                          |\n+---------------------+--------------------------------------------------------------------------+\n\n## Practice with data manipulation\n\n-   **Demo:** Create a new variable called `opened_recently` that has a response of `yes` if the roller coaster was opened after 1970, and `no` if the roller coaster was built during or before 1970. Save this new factor variable in the `rc` data set. Additionally, make `type` a factor variable.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrc <- rc |>\n  mutate(\n    opened_recently = if_else(year_opened > 1970, \"yes\", \"no\"), \n    opened_recently = as.factor(opened_recently),\n    type = as.factor(type)\n  ) \n```\n:::\n\n\n> **We want to investigate the relationship between how fast a roller coaster goes, and how long a roller coaster lasts. Specifically, we are interested in how well the duration of a roller coaster explains how fast it is.**\n\n-   **Your turn:** Based on this research question, which two variables should we use from our data set? Which is our response?\n\ntop_speed; duration\n\ntop_speed is our response\n\n-   **Your turn:** Describe how we can construct a bootstrap distribution for the slope of the model predicting `top_speed` from `duration`.\n\n-   **Demo:** Now, construct this bootstrap distribution.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(12345)\n\nboot_df_slope <- rc |>\n  specify(top_speed ~ duration) |>\n  generate(reps = 1000, type = \"bootstrap\") |>\n  calculate(stat = \"slope\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 34 rows containing missing values.\n```\n:::\n:::\n\n\n-   **Demo:** Create a 90% confidence interval by filling in the code below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nboot_df_slope |>\n  summarize(\n    lower = quantile(stat, 0.05),\n    upper = quantile(stat, 0.95)\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 2\n    lower upper\n    <dbl> <dbl>\n1 -0.0195 0.132\n```\n:::\n:::\n\n\n-   **Demo:** Interpret the confidence interval in the context of the problem.\n\nWe are 90% confident that for a 1 min increase in duration, the true/population mean speed (y) is expected to be 0.0195 lower to 0.132 mph higher.\n\n-   **Demo:** Prediction: How is this different than what we've done before?\n\nNow let's practice predicting!\n\n-   **Demo:** Report the tidy output of your model below\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspeed_fit <- linear_reg() |>\n  set_engine(\"lm\") |>\n  fit(top_speed ~ duration, data = rc) \n\ntidy(speed_fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 5\n  term        estimate std.error statistic  p.value\n  <chr>          <dbl>     <dbl>     <dbl>    <dbl>\n1 (Intercept)  52.0       4.08       12.8  3.99e-24\n2 duration      0.0560    0.0305      1.83 6.92e- 2\n```\n:::\n:::\n\n\n-   Below is the estimated model in proper notation.\n\n$\\widehat{top~speed} = 52 + 0.056 \\times duration$\n\n-   **Demo:** Use your model to estimate the top speed of a roller coaster if their duration is 155 minutes\n\n\n::: {.cell}\n\n```{.r .cell-code}\nduration_155 <- tibble(duration = 155)\n\npredict(speed_fit, new_data = duration_155)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 1\n  .pred\n  <dbl>\n1  60.7\n```\n:::\n:::\n\n\n## Interpret\n\n-   Now, interpret the slope coefficient.\n\nFor a 1 unit minute increase in duration, we estimate on average a 0.0560 increase in mph.\n\n-   What if our response was logged? How does the interpretation change?\n\n$\\widehat{log(TopSpeed)} = 52 + 0.056 \\times Duration$\n\nRecall that to interpret the slope value we need to exponentiate it if we want to be back on the original scale!\n\nWhy?\n\n$log(y) = \\beta_o + \\beta_1x$\n\ny = $exp(\\beta_o + \\beta_1x)$)\n\ny = $exp(\\beta_o) * exp(\\beta_1x)$)\n\nThis implies that our explanatory variable has a multiplicative relationship with our response variable\n\n*For a one minute increase in duration, we estimate on average, top speed to increase by a factor of 0.05, or by about 5%.*\n\n# Research question 3\n\n> **We are also interested in investigating if roller coasters after 1970 are faster than those opened before. For this question, we want to estimate the difference.**\n\n-   Should we make a confidence interval or hypothesis test?\n\n-   **Demo:** Now, use bootstrapping to estimate the difference between the true speeds of roller coasters before and after 1970.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(12345)\n\nboot_df <- rc |>\n  specify(top_speed ~ opened_recently) |>\n  generate(reps = 1000, type = \"bootstrap\") |>\n  calculate(stat = \"diff in means\", order = c(\"yes\", \"no\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 11 rows containing missing values.\n```\n:::\n:::\n\n\n-   **Your turn:** Create a 99% confidence interval and interpret it in the context of the data and the research question.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nboot_df |>\n  summarize(\n    lower = quantile(stat, 0.005),\n    upper = quantile(stat, 0.995)\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 2\n  lower upper\n  <dbl> <dbl>\n1  8.88  23.3\n```\n:::\n:::\n\n\nORDER MATTERS (yes - no)\n\nWe are 99% confident that the true mean speed for roller coasters opened after 1970 ($\\mu_1$) is (9.15, 23) mph LARGER than the true mean speed for roller coasters opened before 1970 ($\\mu_2$)\n\n# Discussion\n\n-   Brainstorm the different between bootstrap and permute. Write down the key differences below. *Hint:* Think back to the different sampling techniques between question 1 and question 2 / 3.\n\nThe main difference between permutation and bootstrapping is that bootstrapping resamples, with replacement from our data. Permutation can be thought of as shuffling / distributing our data / resampling without replacement.\n\n## Interpretation - Return of the Penguins\n\nWe will fit a SRL, MLR, and logistic regression model and compare how we interpret the slope coefficient.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(palmerpenguins)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'palmerpenguins'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:modeldata':\n\n    penguins\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(penguins)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 344\nColumns: 8\n$ species           <fct> Adelie, Adelie, Adelie, Adelie, Adelie, Adelie, Adel…\n$ island            <fct> Torgersen, Torgersen, Torgersen, Torgersen, Torgerse…\n$ bill_length_mm    <dbl> 39.1, 39.5, 40.3, NA, 36.7, 39.3, 38.9, 39.2, 34.1, …\n$ bill_depth_mm     <dbl> 18.7, 17.4, 18.0, NA, 19.3, 20.6, 17.8, 19.6, 18.1, …\n$ flipper_length_mm <int> 181, 186, 195, NA, 193, 190, 181, 195, 193, 190, 186…\n$ body_mass_g       <int> 3750, 3800, 3250, NA, 3450, 3650, 3625, 4675, 3475, …\n$ sex               <fct> male, female, female, NA, female, male, female, male…\n$ year              <int> 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007…\n```\n:::\n:::\n\n\n### Simple Linear Regression\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodelSLR <- linear_reg() |>\n  set_engine(\"lm\") |>\n  fit(flipper_length_mm ~ bill_length_mm, data = penguins)\n\ntidy(modelSLR)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 5\n  term           estimate std.error statistic  p.value\n  <chr>             <dbl>     <dbl>     <dbl>    <dbl>\n1 (Intercept)      127.       4.67       27.2 3.65e-87\n2 bill_length_mm     1.69     0.105      16.0 1.74e-43\n```\n:::\n:::\n\n\n-   Interpret the slope coefficient assocciated with bill_length_mm in the context of the problem\n\nFor a 1 mm increase in bill length, we estimate on average, flipper length to increase by 1.69 mm.\n\n*Add response*\n\n### Multiple Linear Regression\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodelMLR <- linear_reg() |>\n  set_engine(\"lm\") |>\n  fit(flipper_length_mm ~ bill_length_mm + island, data = penguins)\n\ntidy(modelMLR)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 5\n  term            estimate std.error statistic   p.value\n  <chr>              <dbl>     <dbl>     <dbl>     <dbl>\n1 (Intercept)       141.      4.03       35.1  9.60e-115\n2 bill_length_mm      1.51    0.0879     17.2  4.74e- 48\n3 islandDream       -15.0     0.971     -15.4  4.51e- 41\n4 islandTorgersen    -8.98    1.42       -6.34 7.35e- 10\n```\n:::\n:::\n\n\n-   Interpret the slope coefficient associated with bill_length_mm in the context of the problem\n\nFor a 1 mm increase in bill length, we estimate on average, flipper length to increase by 1.51 mm, holding island constant.\n\n### Logistic Regression\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodellog <- logistic_reg() |>\n  set_engine(\"glm\") |>\n  fit(sex ~ bill_length_mm, data = penguins)\n\ntidy(modellog)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 5\n  term           estimate std.error statistic       p.value\n  <chr>             <dbl>     <dbl>     <dbl>         <dbl>\n1 (Intercept)      -6.04     1.01       -5.96 0.00000000247\n2 bill_length_mm    0.138    0.0229      6.02 0.00000000176\n```\n:::\n:::\n\n\n-   Interpret the slope coefficient associated with bill_length_mm in the context of the problem and on the original scale\n\nFor a 1 unit increase in bill length, we expect the odds of being female to increase by a factor of .14, or by about 14%.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}